<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern E-Comm</title>

    <!-- Bootstrap CSS (LTR Version) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <!-- SwiperJS CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <!-- Animate.css for animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }
        .main-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        #app-content {
            flex-grow: 1;
        }
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 1rem 3rem rgba(0,0,0,.175)!important;
        }
        .card-img-top {
            height: 220px;
            object-fit: cover;
        }
        .swiper {
            width: 100%;
            height: 450px;
            border-radius: 0.5rem;
        }
        .swiper-slide {
            text-align: center;
            font-size: 18px;
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .swiper-slide img {
            display: block;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .login-container {
            max-width: 450px;
            margin: 5rem auto;
            padding: 2.5rem;
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);   
        }
        .btn-primary {
            background-image: linear-gradient(to right, #007bff, #0056b3);
            border: none;
        }
        .btn-success {
             background-image: linear-gradient(to right, #28a745, #1e7e34);
             border: none;
        }
    </style>
</head>
<body>

    <div id="app" class="main-container">
        <!-- Dynamic content will be rendered here -->
    </div>

    <!-- Templates for different pages -->
    <template id="navbar-template">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm sticky-top">
            <div class="container">
                <a class="navbar-brand fw-bold" href="#" data-page="home">Mini E-Commerce Wwbsite</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link" href="#" data-page="home">Home</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-page="products">Products</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-page="add-product">Add Product</a></li>
                        <li class="nav-item"><a class="nav-link" href="#" data-page="about">About Us</a></li>
                    </ul>
                    <ul class="navbar-nav">
                        <li class="nav-item">
                           <a class="nav-link" href="#" data-page="cart">
                                Cart <span class="badge bg-primary rounded-pill" id="cart-count">0</span>
                           </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="logout-btn">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </template>

    <template id="login-page-template">
        <div class="container">
            <div class="login-container animate__animated animate__fadeInDown">
                <h2 class="text-center mb-4 fw-bold">Login</h2>
                <form id="login-form">
                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control form-control-lg" id="email" value="user@example.com" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input type="password" class="form-control form-control-lg" id="password" value="123456" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100 btn-lg mt-3">Login</button>
                </form>
            </div>
        </div>
    </template>

    <template id="home-page-template">
        <div class="container py-5">
            <h1 class="text-center mb-4 display-4 fw-bold">Welcome to Our Modern Store</h1>
            <p class="text-center text-muted fs-5 mb-5">Discover a world of technology at your fingertips</p>
            <div class="swiper mySwiper">
                <div class="swiper-wrapper">
                    <div class="swiper-slide"><img src="https://images.unsplash.com/photo-1526738549149-8e07eca6c147?q=80&w=1974&auto=format&fit=crop" alt="Product Showcase"></div>
                    <div class="swiper-slide"><img src="https://images.unsplash.com/photo-1558137623-ce93345596e3?q=80&w=1974&auto=format&fit=crop" alt="Workspace"></div>
                    <div class="swiper-slide"><img src="https://images.unsplash.com/photo-1542491073-266effb7a379?q=80&w=2070&auto=format&fit=crop" alt="Smart Watch"></div>
                    <div class="swiper-slide"><img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?q=80&w=2070&auto=format&fit=crop" alt="Headphones"></div>
                    <div class="swiper-slide"><img src="https://images.unsplash.com/photo-1593642702821-c8da6771f0c6?q=80&w=2070&auto=format&fit=crop" alt="Laptop on Desk"></div>
                </div>
                <div class="swiper-button-next text-white"></div>
                <div class="swiper-button-prev text-white"></div>
                <div class="swiper-pagination"></div>
                </div>
            </div>
        </div>
    </template>

    <template id="products-page-template">
        <div class="container py-5">
            <h1 class="text-center mb-5 display-5 fw-bold">Our Products</h1>
            <div id="products-container" class="row g-4"></div>
        </div>
    </template>

    <template id="add-product-page-template">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-7">
                    <div class="card shadow-lg">
                        <div class="card-body p-5">
                            <h2 class="text-center mb-4 fw-bold">Add a New Product</h2>
                            <form id="add-product-form">
                                <div class="mb-3"><label for="product-name" class="form-label">Product Name</label><input type="text" class="form-control form-control-lg" id="product-name" required></div>
                                <div class="mb-3"><label for="product-price" class="form-label">Product Price (EGP)</label><input type="number" class="form-control form-control-lg" id="product-price" required></div>
                                <div class="mb-3"><label for="product-image" class="form-label">Product Image URL</label><input type="url" class="form-control form-control-lg" id="product-image" placeholder="https://example.com/image.jpg" required></div>
                                <button type="submit" class="btn btn-success w-100 btn-lg mt-3">Add Product</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="about-page-template">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-md-8 text-center">
                    <h1 class="display-5 fw-bold mb-4">Our Story</h1>
                    <p class="lead text-muted">This project is a mini e-commerce website, built to demonstrate the capabilities of modern web technologies in creating interactive and engaging user experiences.</p>
                    <p>We used the latest tools like Bootstrap 5, SwiperJS for animations, and SweetAlert2 for elegant alerts, all powered by vanilla JavaScript in a single-page application architecture.</p>
                    <hr class="my-4">
                    <p><strong>Developer:</strong> RAWDA</p>
                </div>
            </div>
        </div>
    </template>
    
    <template id="cart-page-template">
         <div class="container py-5">
            <h1 class="text-center mb-5 display-5 fw-bold">Shopping Cart</h1>
            <div class="row">
                <div class="col-lg-8" id="cart-items-container"></div>
                <div class="col-lg-4" id="cart-summary-container"></div>
            </div>
        </div>
    </template>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <!-- SwiperJS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const app = document.getElementById('app');

            function initializeProducts() {
                if (!localStorage.getItem('products')) {
                    const initialProducts = [
                        { id: 1, name: 'MacBook Pro Laptop', price: 45000, image: 'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=2000&auto=format&fit=crop' },
                        { id: 2, name: 'iPhone 15 Pro', price: 35000, image: 'https://images.unsplash.com/photo-1695026224215-b74b175a52d3?q=80&w=1974&auto=format&fit=crop' },
                        { id: 3, name: 'Apple Watch Ultra', price: 14500, image: 'https://images.unsplash.com/photo-1546868871-7041f2a55e12?q=80&w=2000&auto=format&fit=crop' },
                        { id: 4, name: 'Sony WH-1000XM5 Headphones', price: 9200, image: 'https://images.unsplash.com/photo-1627734819942-cba62c32b98e?q=80&w=1964&auto=format&fit=crop' },
                        { id: 5, name: 'Canon EOS R5 Camera', price: 65000, image: 'https://images.unsplash.com/photo-1516035069371-29a1b244cc32?q=80&w=2000&auto=format&fit=crop'},
                        { id: 6, name: 'Playstation 5 Console', price: 22000, image: 'https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?q=80&w=2070&auto=format&fit=crop'}
                    ];
                    localStorage.setItem('products', JSON.stringify(initialProducts));
                }
            }

            function initializeCart() {
                if (!localStorage.getItem('cart')) {
                    localStorage.setItem('cart', JSON.stringify([]));
                }
            }

            const getProducts = () => JSON.parse(localStorage.getItem('products')) || [];
            const saveProducts = (products) => localStorage.setItem('products', JSON.stringify(products));
            const getCart = () => JSON.parse(localStorage.getItem('cart')) || [];
            const saveCart = (cart) => localStorage.setItem('cart', JSON.stringify(cart));

            function navigateTo(page) {
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                if (!isLoggedIn && page !== 'login') {
                    navigateTo('login');
                    return;
                }
                if (isLoggedIn && page === 'login') {
                    navigateTo('home');
                    return;
                }

                app.innerHTML = ''; 

                if (page !== 'login') {
                    const navbarTemplate = document.getElementById('navbar-template').content.cloneNode(true);
                    app.appendChild(navbarTemplate);
                    setupNavbar();
                    updateCartCount();
                }

                const pageContentContainer = document.createElement('div');
                pageContentContainer.id = 'app-content';
                pageContentContainer.className = 'animate__animated animate__fadeIn';
                app.appendChild(pageContentContainer);

                const templateId = `${page}-page-template`;
                const template = document.getElementById(templateId);
                if (template) {
                    const pageContent = template.content.cloneNode(true);
                    pageContentContainer.appendChild(pageContent);
                }

                switch (page) {
                    case 'login': setupLoginPage(); break;
                    case 'home': setupHomePage(); break;
                    case 'products': setupProductsPage(); break;
                    case 'add-product': setupAddProductPage(); break;
                    case 'cart': setupCartPage(); break;
                }
            }
            
            function setupNavbar() {
                document.querySelectorAll('.nav-link, .navbar-brand').forEach(link => {
                    if(link.dataset.page) {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            navigateTo(link.dataset.page);
                        });
                    }
                });
                document.getElementById('logout-btn').addEventListener('click', handleLogout);
            }
            
            function setupLoginPage() {
                document.getElementById('login-form').addEventListener('submit', handleLogin);
            }

            function setupHomePage() {
                new Swiper(".mySwiper", {
                    effect: "fade",
                    navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" },
                    pagination: { el: ".swiper-pagination", clickable: true },
                    autoplay: { delay: 3000, disableOnInteraction: false },
                    loop: true,
                });
            }

            function setupProductsPage() {
                const productsContainer = document.getElementById('products-container');
                const products = getProducts();
                productsContainer.innerHTML = '';

                if (products.length === 0) {
                    productsContainer.innerHTML = '<p class="text-center text-muted col-12">No products to display at the moment.</p>';
                    return;
                }

                products.forEach((product, index) => {
                    const card = document.createElement('div');
                    card.className = 'col-lg-4 col-md-6 col-sm-12 animate__animated animate__zoomIn';
                    card.style.animationDelay = `${index * 100}ms`;
                    card.innerHTML = `
                        <div class="card h-100 shadow-sm">
                            <img src="${product.image}" class="card-img-top" alt="${product.name}" onerror="this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found'">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title fw-bold">${product.name}</h5>
                                <p class="card-text fs-5 text-primary fw-bold">${product.price} EGP</p>
                                <div class="mt-auto btn-group w-100">
                                    <button class="btn btn-primary add-to-cart-btn" data-id="${product.id}">Add to Cart</button>
                                    <button class="btn btn-outline-danger remove-product-btn" data-id="${product.id}">Delete</button>
                                </div>
                            </div>
                        </div>
                    `;
                    productsContainer.appendChild(card);
                });

                document.querySelectorAll('.remove-product-btn').forEach(btn => btn.addEventListener('click', (e) => handleRemoveProduct(e.target.dataset.id)));
                document.querySelectorAll('.add-to-cart-btn').forEach(btn => btn.addEventListener('click', (e) => handleAddToCart(e.target.dataset.id)));
            }

            function setupAddProductPage() {
                document.getElementById('add-product-form').addEventListener('submit', handleAddProduct);
            }

            function setupCartPage() {
                const itemsContainer = document.getElementById('cart-items-container');
                const summaryContainer = document.getElementById('cart-summary-container');
                const cart = getCart();
                const products = getProducts();
                
                itemsContainer.innerHTML = '';
                
                if (cart.length === 0) {
                    itemsContainer.innerHTML = '<div class="alert alert-info">Your shopping cart is empty.</div>';
                    summaryContainer.innerHTML = '';
                    return;
                }

                let totalPrice = 0;
                const cartList = document.createElement('ul');
                cartList.className = 'list-group';

                cart.forEach(cartItem => {
                    const product = products.find(p => p.id == cartItem.id);
                    if (product) {
                        const itemTotal = product.price * cartItem.quantity;
                        totalPrice += itemTotal;
                        const li = document.createElement('li');
                        li.className = 'list-group-item d-flex justify-content-between align-items-center';
                        li.innerHTML = `
                            <div>
                                <img src="${product.image}" width="60" class="me-3 rounded" alt="${product.name}">
                                <span class="fw-bold">${product.name}</span>
                                <br>
                                <small class="text-muted">${cartItem.quantity} x ${product.price} EGP</small>
                            </div>
                            <div>
                                <span class="fw-bold me-3">${itemTotal} EGP</span>
                                <button class="btn btn-sm btn-outline-danger remove-from-cart-btn" data-id="${product.id}">&times;</button>
                            </div>
                        `;
                        cartList.appendChild(li);
                    }
                });
                
                itemsContainer.appendChild(cartList);

                summaryContainer.innerHTML = `
                    <div class="card shadow-sm sticky-top" style="top: 100px;">
                        <div class="card-body">
                            <h4 class="card-title fw-bold">Order Summary</h4>
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item d-flex justify-content-between">
                                    <span>Subtotal</span>
                                    <span>${totalPrice} EGP</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between fw-bold fs-5">
                                    <span>Total</span>
                                    <span>${totalPrice} EGP</span>
                                </li>
                            </ul>
                            <button class="btn btn-success w-100 mt-3 btn-lg">Proceed to Checkout</button>
                        </div>
                    </div>
                `;

                document.querySelectorAll('.remove-from-cart-btn').forEach(btn => btn.addEventListener('click', (e) => handleRemoveFromCart(e.target.dataset.id)));
            }
            
            const hardcodedEmail = 'user@example.com';
            const hardcodedPassword = '123456';

            function handleLogin(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                if (!email || !password) {
                    Swal.fire({ icon: 'error', title: 'Input Error', text: 'Please fill in all fields.' });
                    return;
                }

                if (email === hardcodedEmail && password === hardcodedPassword) {
                    localStorage.setItem('isLoggedIn', 'true');
                    Swal.fire({ icon: 'success', title: 'Login Successful!', showConfirmButton: false, timer: 1500 })
                       .then(() => navigateTo('home'));
                } else {
                    Swal.fire({ icon: 'error', title: 'Incorrect Credentials', text: 'The email or password you entered is incorrect.' });
                }
            }

            function handleLogout() {
                localStorage.removeItem('isLoggedIn');
                navigateTo('login');
            }

            function handleRemoveProduct(productId) {
                Swal.fire({
                    title: 'Are you sure?',
                    text: "This will permanently delete the product!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!',
                    cancelButtonText: 'Cancel'
                }).then((result) => {
                    if (result.isConfirmed) {
                        let products = getProducts();
                        products = products.filter(p => p.id != productId);
                        saveProducts(products);
                        
                        let cart = getCart();
                        cart = cart.filter(item => item.id != productId);
                        saveCart(cart);

                        Swal.fire('Deleted!', 'The product has been deleted.', 'success');
                        navigateTo('products');
                    }
                });
            }

            function handleAddProduct(e) {
                e.preventDefault();
                const name = document.getElementById('product-name').value.trim();
                const price = document.getElementById('product-price').value.trim();
                const image = document.getElementById('product-image').value.trim();

                if (!name || !price || !image) {
                     Swal.fire('Error', 'Please fill in all fields.', 'error');
                     return;
                }

                let products = getProducts();
                const newProduct = { id: Date.now(), name, price: parseFloat(price), image };
                products.push(newProduct);
                saveProducts(products);

                Swal.fire({ icon: 'success', title: 'Product Added!', timer: 2000, showConfirmButton: false })
                   .then(() => navigateTo('products'));
            }

            function handleAddToCart(productId) {
                let cart = getCart();
                const existingItem = cart.find(item => item.id == productId);

                if(existingItem) {
                    existingItem.quantity++;
                } else {
                    cart.push({ id: productId, quantity: 1 });
                }

                saveCart(cart);
                updateCartCount();
                
                const cartIcon = document.querySelector('#cart-count');
                if(cartIcon) {
                    cartIcon.parentElement.classList.add('animate__animated', 'animate__tada');
                    cartIcon.parentElement.addEventListener('animationend', () => {
                        cartIcon.parentElement.classList.remove('animate__animated', 'animate__tada');
                    });
                }

                Swal.fire({ icon: 'success', title: 'Added to cart!', toast: true, position: 'top-end', showConfirmButton: false, timer: 1500, timerProgressBar: true });
            }
            
            function handleRemoveFromCart(productId) {
                let cart = getCart();
                cart = cart.filter(item => item.id != productId);
                saveCart(cart);
                updateCartCount();
                navigateTo('cart');
            }
            
            function updateCartCount() {
                const cartCountEl = document.getElementById('cart-count');
                if (cartCountEl) {
                    const cart = getCart();
                    cartCountEl.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
                }
            }

            function main() {
                initializeProducts();
                initializeCart();
                const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                navigateTo(isLoggedIn ? 'home' : 'login');
            }

            main();
        });
    </script>
</body>
</html>
